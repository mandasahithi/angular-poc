<!-- Main Content -->
<main class="main-content">
<div class="container my-4">
  <div class="d-flex justify-content-between align-items-center mb-3">
    <h3 class="mb-0">Users</h3>
    <div>
      <button type="button" class="btn btn-primary" (click)="addNew()" *ngIf="!showForm">Add New User</button>
      <button type="button" class="btn btn-secondary" (click)="cancel()" *ngIf="showForm">Back to List</button>
    </div>
  </div>

  <!-- Form view -->
  <div *ngIf="showForm" class="dialog-backdrop">
    <div class="card dialog">
      <div class="card-body">
        <form #userForm="ngForm" (ngSubmit)="isEditMode ? updateUser(userForm) : saveUser(userForm)" novalidate>
          <div class="row">
            <div class="col-md-6 mb-3">
              <label class="form-label">First Name</label>
              <input name="firstName" class="form-control" [(ngModel)]="currentUser.firstName" #firstName="ngModel"
                required minlength="4" />
              <div class="text-danger small mt-1"
                *ngIf="firstName.invalid && (firstName.dirty || firstName.touched || formSubmitted)">
                <div *ngIf="firstName.errors?.['required']">First name is required.</div>
                <div *ngIf="firstName.errors?.['minlength']">Minimum 4 characters required.</div>
              </div>
            </div>

            <div class="col-md-6 mb-3">
              <label class="form-label">Last Name</label>
              <input name="lastName" class="form-control" [(ngModel)]="currentUser.lastName" #lastName="ngModel"
                required minlength="4" />
              <div class="text-danger small mt-1"
                *ngIf="lastName.invalid && (lastName.dirty || lastName.touched || formSubmitted)">
                <div *ngIf="lastName.errors?.['required']">Last name is required.</div>
                <div *ngIf="lastName.errors?.['minlength']">Minimum 4 characters required.</div>
              </div>
            </div>

            <div class="col-md-6 mb-3">
              <label class="form-label">Username</label>
              <input name="username" class="form-control" [(ngModel)]="currentUser.username" #username="ngModel"
                required minlength="4" />
              <div class="text-danger small mt-1"
                *ngIf="username.invalid && (username.dirty || username.touched || formSubmitted)">
                <div *ngIf="username.errors?.['required']">Username is required.</div>
                <div *ngIf="username.errors?.['minlength']">Minimum 4 characters required.</div>
              </div>
            </div>

            <div class="col-md-6 mb-3">
              <label class="form-label">City</label>
              <input name="city" class="form-control" [(ngModel)]="currentUser.city" #city="ngModel" required
                minlength="4" />
              <div class="text-danger small mt-1" *ngIf="city.invalid && (city.dirty || city.touched || formSubmitted)">
                <div *ngIf="city.errors?.['required']">City is required.</div>
                <div *ngIf="city.errors?.['minlength']">Minimum 4 characters required.</div>
              </div>
            </div>

            <div class="col-md-4 mb-3">
              <label class="form-label">State</label>
              <input name="state" class="form-control" [(ngModel)]="currentUser.state" #state="ngModel" required
                minlength="4" />
              <div class="text-danger small mt-1"
                *ngIf="state.invalid && (state.dirty || state.touched || formSubmitted)">
                <div *ngIf="state.errors?.['required']">State is required.</div>
                <div *ngIf="state.errors?.['minlength']">Minimum 4 characters required.</div>
              </div>
            </div>

            <div class="col-md-4 mb-3">
              <label class="form-label">Zip Code</label>
              <input name="zipCode" class="form-control" [(ngModel)]="currentUser.zipCode" #zipCode="ngModel" required
                minlength="4" />
              <div class="text-danger small mt-1"
                *ngIf="zipCode.invalid && (zipCode.dirty || zipCode.touched || formSubmitted)">
                <div *ngIf="zipCode.errors?.['required']">Zip code is required.</div>
                <div *ngIf="zipCode.errors?.['minlength']">Minimum 4 characters required.</div>
              </div>
            </div>

            <div class="col-md-4 mb-3 d-flex align-items-center">
              <div class="form-check">
                <input class="form-check-input" type="checkbox" id="agree" name="agree" [(ngModel)]="currentUser.agree"
                  #agree="ngModel" required />
                <label class="form-check-label" for="agree">I agree</label>
                <div class="text-danger small mt-1"
                  *ngIf="agree.invalid && (agree.dirty || agree.touched || formSubmitted)">
                  <div *ngIf="agree.errors?.['required']">You must agree.</div>
                </div>
              </div>
            </div>
          </div>

          <div class="mt-3">
            <button type="submit" class="btn btn-success" *ngIf="!isEditMode">Save User</button>
            <button type="submit" class="btn btn-primary" *ngIf="isEditMode">Update User</button>
            <button type="button" class="btn btn-secondary ms-2" (click)="cancel()">Cancel</button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <!-- List view -->
  <div *ngIf="!showForm">
    <div class="row g-3">
      <div class="col-12 col-sm-6 col-md-4 col-lg-3" *ngFor="let u of users">
        <div class="card h-100">
          <div class="card-body d-flex flex-column">
            <h5 class="card-title">{{ fullName(u) || u.username }}</h5>
            <h6 class="card-subtitle mb-2 text-muted">{{ '@' + u.username }}</h6>
            <p class="card-text mb-1"><strong>City:</strong> {{ u.city }}</p>
            <p class="card-text mb-2"><strong>State:</strong> {{ u.state }}</p>
            <p class="card-text mb-2"><strong>ZipCode:</strong> {{ u.zipCode }}</p>
            <div class="mt-auto d-flex gap-2">
              <button class="btn btn-sm btn-outline-primary" (click)="editUser(u)">Edit</button>
              <button class="btn btn-sm btn-outline-danger" (click)="deleteUser(u)">Delete</button>
            </div>
          </div>
        </div>
      </div>
      <div *ngIf="users.length === 0" class="col-12">
        <div class="alert alert-info">No users found. Click "Add New User" to create one.</div>
      </div>
    </div>
  </div>
</div>
</main>
